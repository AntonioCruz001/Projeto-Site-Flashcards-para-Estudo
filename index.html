<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flash Cards</title>

    <style>
        * {
            --bgc-div-frente: #6ad6bf;
            --bgc-div-verso: #eab276;
            margin: 0px;
            padding: 0px;
        }

        header {
            text-align: center;
            padding: 30px;
            margin-bottom: 5px;
            background-color: rgb(189, 209, 226);
        }


        .nav-container {
            background-color: rgb(189, 209, 226);
            display: flex;
            justify-content: center;
        }

        .paginas-nav {
            padding: 10px 10px;
            margin-top: 5px;
            margin-bottom: 5px;
            width: 500px;
            display: flex;
            justify-content: space-between;
            gap: 5px;
        }

        .pagina {
            padding: 5px 20px;
        }

        button {
            border-style: none;
            border-radius: 3px;
        }

        [data-page-active] {
            background-color: yellow;
        }

        #form-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 25px;
            background-color: rgb(152, 165, 203);
            padding: 30px;
        }

        #formulario {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 500px;
            margin: 0px auto;
        }

        #config-container {
            display: flex;
            flex-direction: row;
            justify-content: center;
        }

        #apagar {
            padding: 5px;
            color: rgb(255, 237, 122);
            background-color: rgb(234, 126, 37);
            border: 2px solid salmon;
            border-radius: 8px;

            transition: background-color .3s ease-in-out, color .3s ease-in-out;
        }

        #apagar:hover {
            color: rgb(3, 52, 83);
            background-color: rgb(241, 182, 54);
            transition: background-color .3s ease-in-out, color .3s ease-in-out;
        }


        #apagar:active {
            color: rgb(14, 91, 132);
            background-color: rgb(253, 231, 122);
            transition: background-color .0s ease-in-out, color .0s ease-in-out;
        }

        #flashCards-container {
            box-sizing: border-box;
            margin: 20px 1px;
            display: grid;
            grid-template-columns: 33% 33% 33%;
            gap: .8% .4%;
        }

        .card {
            display: flex;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
            background-color: var(--bgc-div-frente);
            height: 140px;
            overflow-y: auto;

            border-radius: 10px;
            text-align: center;
            /* Para impedir selecao seleção selection */
            user-select: none;
        }

        .texto-card {
            box-sizing: border-box;
            width: 100%;
            max-height: 100%;
            margin: 0;
            padding: 0 8px;
            word-break: keep-all;
        }

        @media (max-width:1000px) {
            #flashCards-container {
                grid-template-columns: 50% 50%;
                gap: .8% .4%;
            }
        }

        @media (max-width:600px) {
            #flashCards-container {
                grid-template-columns: 100%;
                gap: .8% .4%;
            }

            #formulario {
                width: 300px;
            }
        }
    </style>
</head>

<body>

    <div>
        <header>
            <h1>Flash Cards para Estudo</h1>
        </header>

        <div class="nav-container">
            <nav class="paginas-nav">
                <button class="pagina" data-page="1" data-page-active="">SUS</button>
                <button class="pagina" data-page="2">ACS</button>
                <button class="pagina" data-page="3">Port</button>
                <button class="pagina" data-page="4">Lógica</button>
            </nav>
        </div>
    </div>

    <div id="form-container">
        <form id="formulario">
            <input type="text" id="frente" class="teste" placeholder="Frente">
            <textarea name="verso" id="verso" cols="30" rows="4" placeholder="Verso"></textarea>
            <button id="confirmar" type="button">Confirmar</button>
        </form>
        <div id="config-container">
            <button id="apagar" type="button">Apagar todos os cards</button>
        </div>
    </div>

    <div id="flashCards-container">

    </div>



    <script>
        // NOMES dos storages:
        // página atual = paginaAtualFlashCard
        // lista de cards = listaDeCardsFlashCard

        // Página atual inicial no storage
        const paginaAtualInicio = document.querySelector('[data-page-active]').getAttribute('data-page')
        localStorage.setItem('paginaAtualFlashCard', JSON.stringify(paginaAtualInicio))

        // Vaiáveis Iniciais
        const frente = document.querySelectorAll('[lado="frente"]')
        const verso = document.querySelectorAll('[lado="verso"]')
        const submit = document.getElementById('confirmar')
        const apagar = document.getElementById('apagar')
        const flashCardContainer = document.getElementById('flashCards-container')
        const inputFrente = document.getElementById('frente')
        const inputVerso = document.getElementById('verso')

        function recupDoStorage(storage) {
            switch (storage) {
                case 'listaDeCardsFlashCard':
                    // precisa ser "let"!
                    // cards precisa ser um array!!!!
                    let listaDeCards = JSON.parse(localStorage.getItem('listaDeCardsFlashCard')) || [{
                        page1: { cards: [] },
                        page2: { cards: [] },
                        page3: { cards: [] },
                        page4: { cards: [] },
                    }];
                    return listaDeCards
                    break;

                case 'paginaAtualFlashCard':
                    let paginaAtual = JSON.parse(localStorage.getItem('paginaAtualFlashCard')) || document.querySelector('[data-page-active]').getAttribute('data-page')
                    return paginaAtual
                    break;

                default:
                    break;
            }
        }

        // Função que cria elementos dos cards
        function criarElementoCard(elemento, conteudo) {
            switch (elemento) {
                case 'div':
                    const elem = document.createElement(elemento)

                    elem.setAttribute('class', 'card');
                    elem.setAttribute('lado', 'frente');

                    return elem
                    break;

                case 'pre':
                    const pre = document.createElement(elemento)
                    pre.setAttribute('class', 'texto-card');
                    pre.innerHTML = conteudo

                    return pre
                    break;

                default:
                    break;
            }
        }

        // Função de criação
        // Criando as divs com os dados do localStorage
        function buildUp() {
            let listaDeCards = recupDoStorage('listaDeCardsFlashCard')
            const paginaAtual = recupDoStorage('paginaAtualFlashCard')
            let page = `page${paginaAtual}`
            let arrayCards = listaDeCards[0][page].cards

            if (listaDeCards) {
                if (arrayCards != "") {
                    for (const card in arrayCards) { // card não é um objeto aqui!

                        //console.log('arrayCards:',arrayCards);

                        let div = criarElementoCard('div')
                        div.setAttribute('index', `${card}`)

                        const p = criarElementoCard('pre', arrayCards[card].frente)

                        flashCardContainer.appendChild(div);
                        div.innerHTML = p.outerHTML
                    }
                }

                // Funcionalidade de virar os cards que já estão na memória
                // getAttribute retorna o valor do atributo
                const card = document.querySelectorAll('.card')
                card.forEach(div => {
                    div.addEventListener('click', () => {
                        if (div.getAttribute('lado') == 'frente') {

                            div.style.backgroundColor = 'var(--bgc-div-verso)';

                            const p = div.firstChild
                            p.innerHTML = arrayCards[div.getAttribute('index')].verso;

                            div.setAttribute('lado', 'verso');
                            div.innerHTML = p.outerHTML

                        } else if (div.getAttribute('lado') == 'verso') {

                            div.style.backgroundColor = 'var(--bgc-div-frente)';

                            const p = div.firstChild
                            p.innerHTML = arrayCards[div.getAttribute('index')].frente;

                            div.setAttribute('lado', 'frente');
                            div.innerHTML = p.outerHTML
                        }
                    })
                })
            }
        }
        buildUp()

        // Páginas
        const paginas = document.querySelectorAll('.pagina')
        paginas.forEach(page => {
            page.addEventListener('click', () => {
                if (!page.hasAttribute('data-page-active')) {

                    // Estilo do botão de página ativo
                    const active = document.querySelector('[data-page-active]')
                    active.removeAttribute('data-page-active')

                    // Página atual está ativa
                    page.setAttribute('data-page-active', "")

                    // pagina atual para o localStorage
                    const paginaAtual = page.getAttribute('data-page')
                    localStorage.setItem('paginaAtualFlashCard', JSON.stringify(paginaAtual))

                    // Apagar o container para seguir p/ a próxima página
                    if (flashCardContainer.hasChildNodes) {
                        flashCardContainer.innerHTML = ""
                    }

                    // Criar os cards a partir da memória(storage)
                    buildUp()
                }
            })
        })


        // Registrando um flash card
        submit.onclick = function (e) {
            if ((inputFrente.value == "")) {
                inputFrente.focus()
            } else if ((inputVerso.value == "")) {
                inputVerso.focus()
            } else {

                const div = criarElementoCard('div')
                const p = criarElementoCard('pre', inputFrente.value)

                flashCardContainer.appendChild(div);
                div.innerHTML = p.outerHTML

                const paginaAtual = recupDoStorage('paginaAtualFlashCard')
                let page = `page${paginaAtual}`

                const objCard = { 'frente': inputFrente.value, 'verso': inputVerso.value };

                let listaDeCardsTemp = recupDoStorage('listaDeCardsFlashCard')
                
                // push no obj completo
                listaDeCardsTemp[0][page].cards.push(objCard);
                
                // apenas array de cards
                let arrayCards = listaDeCardsTemp[0][page].cards 

                div.setAttribute('index', `${arrayCards.length - 1}` || '0')

                // adicionando o event listener
                div.addEventListener('click', () => {
                    if (div.getAttribute('lado') == 'frente') {
                        div.style.backgroundColor = 'var(--bgc-div-verso)';
                        p.innerHTML = arrayCards[div.getAttribute('index')].verso

                        div.setAttribute('lado', 'verso');
                        div.innerHTML = p.outerHTML
                    } else if (div.getAttribute('lado') == 'verso') {
                        div.style.backgroundColor = 'var(--bgc-div-frente)';
                        p.innerHTML = arrayCards[div.getAttribute('index')].frente

                        div.setAttribute('lado', 'frente');
                        div.innerHTML = p.outerHTML
                    }
                })

                localStorage.setItem('listaDeCardsFlashCard', JSON.stringify(listaDeCardsTemp));
                document.querySelector('#formulario').reset();
            }
        }

        // apagarLocalStorage()
        apagar.onclick = function apagarLocalStorage() {
            if (confirm('Deseja apagar todos os cards?')) {
                flashCardContainer.innerHTML = '';
                localStorage.removeItem('listaDeCardsFlashCard')
            }
        }
    </script>
</body>

</html>